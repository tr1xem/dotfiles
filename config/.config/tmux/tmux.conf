# set -g default-terminal "tmux-256color"
set-option -g default-shell $SHELL
set -ga update-environment TERM
set -ga update-environment TERM_PROGRAM
set-option -sa terminal-overrides ",xterm*:Tc"
set -gq allow-passthrough on
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'tmux-plugins/tmux-yank'
# set -g @plugin 'catppuccin/tmux'
# Initialize TPM



### General Options ###
set -g mouse on
set -g status-interval 6
set -g set-titles on
set -g set-titles-string "#W/#T"
setw -g automatic-rename on
setw -g mode-keys vi


#THEME
gray_light="#D8DEE9"
gray_medium="#ABB2BF"
gray_dark="#3B4252"
green_soft="#A3BE8C"
blue_muted="#81A1C1"
cyan_soft="#88C0D0"

set -g status-position top
set -g status-left-length 100
set -g status-style "fg=${gray_light},bg=default"
set -g status-left "#[fg=${green_soft},bold] #S #[fg=${gray_light},nobold] |"

set -g window-status-current-format "#[fg=${cyan_soft},bold]  #I:#W"
set -g window-status-format " #I:#W"
set -g message-style "fg=${gray_light},bg=default"
set -g mode-style "fg=${gray_dark},bg=${blue_muted}"
set -g pane-border-style "fg=${gray_dark}"
set -g pane-active-border-style "fg=${gray_medium}"
set -g status-right "#(date '+#[fg=${cyan_soft},bold]󰥔 #[fg=${gray_light},nobold]%I:%M #[fg=${cyan_soft},bold]󰃭 #[fg=${gray_light},nobold]%A,%d %b')"







# set -g @catppuccin_flavor "mocha"
# set -g @catppuccin_status_background "none"
# set -g @catppuccin_window_status_style "none"
# set -g @catppuccin_pane_status_enabled "off"
# set -g @catppuccin_pane_border_status "off"

# # Configure Online status
# set -g @online_icon "ok"
# set -g @offline_icon "nok"
#
# # status left look and feel
# set -g status-left-length 100
# set -g status-left ""
# set -ga status-left "#{?client_prefix,#{#[bg=#{@thm_red},fg=#{@thm_bg},bold]  #S },#{#[bg=#{@thm_bg},fg=#{@thm_green}]  #S }}"
# set -ga status-left "#[bg=#{@thm_bg},fg=#{@thm_overlay_0},none]│"
# set -ga status-left "#[bg=#{@thm_bg},fg=#{@thm_maroon}]  #{pane_current_command} "
# set -ga status-left "#[bg=#{@thm_bg},fg=#{@thm_overlay_0},none]│"
# set -ga status-left "#[bg=#{@thm_bg},fg=#{@thm_blue}]  #{=/-32/...:#{s|$USER|~|:#{b:pane_current_path}}} "
# set -ga status-left "#[bg=#{@thm_bg},fg=#{@thm_overlay_0},none]#{?window_zoomed_flag,│,}"
# set -ga status-left "#[bg=#{@thm_bg},fg=#{@thm_yellow}]#{?window_zoomed_flag,  zoom ,}"
#
# # status right look and feel
# set -g status-right-length 100
# set -g status-right ""
# set -ga status-right "#{?#{e|>=:10,#{battery_percentage}},#{#[bg=#{@thm_red},fg=#{@thm_bg}]},#{#[bg=#{@thm_bg},fg=#{@thm_pink}]}} #{battery_icon} #{battery_percentage} "
# # set -ga status-right "#[bg=#{@thm_bg},fg=#{@thm_overlay_0}, none]│"
# set -ga status-right "#[bg=#{@thm_bg}]#{?#{==:#{online_status},ok},#[fg=#{@thm_mauve}] 󰖩 on ,#[fg=#{@thm_red},bold]#[reverse] 󰖪 off }"
# set -ga status-right "#[bg=#{@thm_bg},fg=#{@thm_overlay_0}, none]│"
# set -ga status-right "#[bg=#{@thm_bg},fg=#{@thm_blue}] 󰅐 %I:%M %P "
#
#
# # Configure Tmux
# set -g status-position top
# set -g status-style "bg=#{@thm_bg}"
# set -g status-justify "absolute-centre"
#
# # pane border look and feel
# # setw -g pane-border-status top
# # setw -g pane-border-format ""
# # setw -g pane-active-border-style "bg=#{@thm_bg},fg=#{@thm_overlay_0}"
# # setw -g pane-border-style "bg=#{@thm_bg},fg=#{@thm_surface_0}"
# # setw -g pane-border-lines single
#
# # window look and feel
# set -wg automatic-rename on
# set -g automatic-rename-format "#{pane_current_command}"
#
# set -g window-status-format " #I#{?#{!=:#{window_name},Window},: #W,} "
# set -g window-status-style "bg=#{@thm_bg},fg=#{@thm_rosewater}"
# set -g window-status-last-style "bg=#{@thm_bg},fg=#{@thm_peach}"
# set -g window-status-activity-style "bg=#{@thm_red},fg=#{@thm_bg}"
# set -g window-status-bell-style "bg=#{@thm_red},fg=#{@thm_bg},bold"
# set -gF window-status-separator "#[bg=#{@thm_bg},fg=#{@thm_overlay_0}]│"
#
# set -g window-status-current-format " #I#{?#{!=:#{window_name},Window},: #W,} "
# set -g window-status-current-style "bg=#{@thm_peach},fg=#{@thm_bg},bold"

### Prefix Customization ###
unbind C-b
set -g prefix C-a
bind C-a send-prefix
set -s escape-time 0
unbind C-Space

### Reload config easily ###
bind r source-file ~/.config/tmux/tmux.conf \; display-message 'Config Reloaded!'

### Copy Mode and Yank ###
unbind v
bind v copy-mode
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "xsel -i -p && xsel -o -p | xsel -i -b"
bind p run-shell "tmux set-buffer \"$(xsel -ob)\"; tmux paste-buffer"

### Pane Resizing ###
# bind -r M-Up resize-pane -U 6
# bind -r M-Down resize-pane -D 5
# bind -r M-Left resize-pane -L 5
# bind -r M-Right resize-pane -R 5

### Client Switching ###
bind -n C-Up switch-client -p
bind -n C-Down switch-client -n
bind -r ^ last-window

### Vim-Aware Smart Pane Navigation ###
# Detect if the current pane is running vim or nvim
set -g @vim_check 'tmux display-message -p "#{pane_current_command}" | grep -iqE "^(n?vim|vimx)$"'

# Navigation keybindings that send keys to vim/nvim or move tmux pane
bind -n C-h if-shell "#{@vim_check}" "send-keys C-h" "select-pane -L"
bind -n C-j if-shell "#{@vim_check}" "send-keys C-j" "select-pane -D"
bind -n C-k if-shell "#{@vim_check}" "send-keys C-k" "select-pane -U"
bind -n C-l if-shell "#{@vim_check}" "send-keys C-l" "select-pane -R"


### Copy-Mode Pane Movement ###
bind -T copy-mode-vi C-h select-pane -L
bind -T copy-mode-vi C-j select-pane -D
bind -T copy-mode-vi C-k select-pane -U
bind -T copy-mode-vi C-l select-pane -R

### Custom Scripts ###
bind -r f run-shell "tmux neww ~/.local/bin/tmux-sessionizer"
bind -r i run-shell "tmux neww ~/.local/bin/tmuxcht"
bind -r D neww -c "#{pane_current_path}" '[ -f TODO.md ] && nvim TODO.md || nvim ~/personal/todo.md'

### Window and Pane Indexing ###
set -g base-index 1
set -g pane-base-index 1
setw -g pane-base-index 1
set -g renumber-windows on

### Window Navigation with Shift and Alt ###
bind -n S-Left previous-window
bind -n S-Right next-window
bind -n M-H previous-window
bind -n M-L next-window


unbind -T copy-mode-vi MouseDragEnd1Pane


set -g @plugin 'omerxx/tmux-sessionx' # default keybind "<prefix> O" to activate
set -g @sessionx-bind 'o'

run '~/.config/tmux/plugins/tpm/tpm' # always keep this line last
